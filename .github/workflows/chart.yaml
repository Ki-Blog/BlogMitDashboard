name: Deploy Helm Chart to GitHub Pages

on:
  push:
    branches:
      - gh-pages

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Set up Helm
      uses: azure/setup-helm@v1

    - name: Package Helm chart
      run: helm package k8s/BlogDashboard-chart

    - name: Checkout gh-pages branch
      run: |
        git config --global user.email "your-email@example.com"
        git config --global user.name "Your Name"
        git checkout gh-pages
        git pull origin gh-pages

    - name: Move new chart package
      run: mv -n *.tgz .

    - name: Generate Helm repo index
      run: helm repo index . --url https://ki-blog.github.io/BlogMitDashboard/

    - name: Add and commit changes
      run: |
        git add .
        git commit -m "feat: Publish new Helm chart"

    - name: Push changes to gh-pages
      run: git push origin gh-pages 